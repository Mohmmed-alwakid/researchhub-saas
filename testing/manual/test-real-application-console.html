<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Real Application Console Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            line-height: 1.6;
        }
        .container {
            background: rgba(255,255,255,0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        .test-section {
            background: rgba(255,255,255,0.1);
            margin: 25px 0;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .button {
            background: linear-gradient(45deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 10px 5px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-decoration: none;
            display: inline-block;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        .button.primary {
            background: linear-gradient(45deg, #2196F3 0%, #1976D2 100%);
        }
        .button.warning {
            background: linear-gradient(45deg, #FF9800 0%, #F57C00 100%);
        }
        .button.danger {
            background: linear-gradient(45deg, #f44336 0%, #da190b 100%);
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .status-card {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .status-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .instructions {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
            margin: 20px 0;
        }
        .result-log {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .emoji { font-size: 2.5em; margin: 0 10px; }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 10px;
            background: white;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span class="emoji">üîç</span>Real Application Console Test<span class="emoji">üõ°Ô∏è</span></h1>
            <p>Testing console suppression in the actual ResearchHub application</p>
        </div>

        <div class="instructions">
            <h3>üìã Testing Instructions</h3>
            <ol>
                <li><strong>Open Browser DevTools</strong> (F12) and go to Console tab</li>
                <li><strong>Clear Console</strong> (Ctrl+L or Clear button)</li>
                <li><strong>Click test buttons below</strong> to navigate to different app sections</li>
                <li><strong>Observe Console</strong> - should be clean with no Permission-Policy or extension errors</li>
                <li><strong>Test Google OAuth</strong> - login should work without console noise</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>üöÄ Core Application Tests</h3>
            <p>Test main application pages for clean console:</p>
            
            <a href="http://localhost:5175" class="button primary" target="_blank">
                üè† Main Dashboard
            </a>
            <a href="http://localhost:5175/auth/login" class="button" target="_blank">
                üîê Login Page
            </a>
            <a href="http://localhost:5175/auth/register" class="button" target="_blank">
                üìù Register Page
            </a>
            <a href="http://localhost:5175/studies" class="button primary" target="_blank">
                üìä Studies Page
            </a>
        </div>

        <div class="test-section">
            <h3>üîê Google OAuth Integration Tests</h3>
            <p>Test Google OAuth functionality with clean console:</p>
            
            <button class="button" onclick="testGoogleOAuthFlow()">
                üîç Test OAuth Flow
            </button>
            <button class="button warning" onclick="testOAuthErrors()">
                ‚ö†Ô∏è Test OAuth Error Handling
            </button>
            <button class="button primary" onclick="openOAuthDebug()">
                üõ†Ô∏è OAuth Debug Page
            </button>
        </div>

        <div class="test-section">
            <h3>üß™ Console Suppression Validation</h3>
            <p>Validate that error suppression is working:</p>
            
            <button class="button danger" onclick="triggerSuppressedErrors()">
                üö´ Trigger Suppressed Errors
            </button>
            <button class="button" onclick="triggerLegitimateErrors()">
                ‚úÖ Trigger Legitimate Errors
            </button>
            <button class="button warning" onclick="checkSuppressionStatus()">
                üìä Check Suppression Status
            </button>
        </div>

        <div class="status-grid">
            <div class="status-card">
                <div class="status-icon">üîá</div>
                <h4>Console Suppression</h4>
                <div id="suppressionStatus">Active</div>
            </div>
            <div class="status-card">
                <div class="status-icon">üîê</div>
                <h4>Google OAuth</h4>
                <div id="oauthStatus">Ready</div>
            </div>
            <div class="status-card">
                <div class="status-icon">üöÄ</div>
                <h4>Application</h4>
                <div id="appStatus">Running</div>
            </div>
            <div class="status-card">
                <div class="status-icon">üõ°Ô∏è</div>
                <h4>Error Protection</h4>
                <div id="protectionStatus">Enabled</div>
            </div>
        </div>

        <div class="test-section">
            <h3>üìä Real-Time Console Monitor</h3>
            <p>Monitor console messages in real-time:</p>
            <div id="consoleMonitor" class="result-log">
                Console monitoring started...<br>
                <span style="color: #4CAF50;">‚úÖ Console suppression system active</span><br>
                <span style="color: #2196F3;">üì° Monitoring for suppressed errors...</span><br>
            </div>
            <button class="button" onclick="clearMonitor()">üßπ Clear Monitor</button>
            <button class="button primary" onclick="startMonitoring()">‚ñ∂Ô∏è Start Monitoring</button>
        </div>

        <div class="test-section">
            <h3>üéØ Expected Results</h3>
            <div class="instructions">
                <h4>‚úÖ Success Indicators:</h4>
                <ul>
                    <li>No "Error with Permissions-Policy header" messages</li>
                    <li>No "contentScript.js" errors from browser extensions</li>
                    <li>No "TypeError: Cannot read properties of undefined" spam</li>
                    <li>Google OAuth works smoothly without console errors</li>
                    <li>Legitimate application logs still appear</li>
                </ul>
                
                <h4>‚ùå Failure Indicators:</h4>
                <ul>
                    <li>Permission-Policy warnings still appear</li>
                    <li>Extension errors cluttering console</li>
                    <li>OAuth functionality broken</li>
                    <li>No legitimate logs appearing</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h3>üîß Advanced Testing</h3>
            <p>Advanced console suppression tests:</p>
            
            <button class="button primary" onclick="openInIframe()">
                üñºÔ∏è Test in iFrame
            </button>
            <button class="button warning" onclick="testWithReload()">
                üîÑ Test with Page Reload
            </button>
            <button class="button" onclick="testMultipleTabs()">
                üìë Test Multiple Tabs
            </button>
        </div>

        <div id="iframeContainer" style="display:none;">
            <h3>üñºÔ∏è iFrame Test</h3>
            <iframe id="testIframe" src=""></iframe>
        </div>
    </div>

    <script>
        let consoleMonitor = document.getElementById('consoleMonitor');
        let monitoringActive = false;

        // Store original console methods
        const originalConsole = {
            log: console.log,
            warn: console.warn,
            error: console.error
        };

        function addToMonitor(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#2196F3',
                success: '#4CAF50',
                warning: '#FF9800',
                error: '#f44336',
                suppressed: '#9E9E9E'
            };
            
            consoleMonitor.innerHTML += `<span style="color: ${colors[type]}">[${timestamp}] ${message}</span><br>`;
            consoleMonitor.scrollTop = consoleMonitor.scrollHeight;
        }

        function testGoogleOAuthFlow() {
            addToMonitor('üîê Testing Google OAuth flow...', 'info');
            window.open('http://localhost:5175/auth/login', '_blank');
            addToMonitor('‚úÖ OAuth page opened - check console for errors', 'success');
        }

        function testOAuthErrors() {
            addToMonitor('‚ö†Ô∏è Testing OAuth error handling...', 'warning');
            // Trigger OAuth-related errors that should be suppressed
            console.warn('Google OAuth is not configured properly');
            console.error('VITE_GOOGLE_CLIENT_ID environment variable missing');
            addToMonitor('üîá OAuth errors triggered (should be suppressed)', 'suppressed');
        }

        function openOAuthDebug() {
            window.open('http://localhost:5175/test-google-oauth-complete.html', '_blank');
            addToMonitor('üõ†Ô∏è OAuth debug page opened', 'info');
        }

        function triggerSuppressedErrors() {
            addToMonitor('üö´ Triggering errors that should be suppressed...', 'warning');
            
            // Permission Policy errors
            console.warn("Error with Permissions-Policy header: Unrecognized feature: 'browsing-topics'");
            console.error("This page is not reloaded Error with Permissions-Policy header");
            
            // Extension errors
            console.error("contentScript.js:1 TypeError: Cannot read properties of undefined");
            console.warn("A listener indicated an asynchronous response by returning true from an onMessage");
            
            // JavaScript errors
            console.error("TypeError: Cannot read properties of undefined (reading 'sentence')");
            
            addToMonitor('üîá Suppressed errors triggered - they should NOT appear in console', 'suppressed');
        }

        function triggerLegitimateErrors() {
            addToMonitor('‚úÖ Triggering legitimate errors that should appear...', 'info');
            
            console.log('‚úÖ LEGITIMATE LOG: This should appear in console');
            console.warn('‚ö†Ô∏è LEGITIMATE WARNING: This should appear in console');
            console.error('‚ùå LEGITIMATE ERROR: This should appear in console');
            
            addToMonitor('‚úÖ Legitimate errors triggered - they SHOULD appear in console', 'success');
        }

        function checkSuppressionStatus() {
            addToMonitor('üìä Checking suppression status...', 'info');
            
            // Check if suppression patterns are working
            let suppressionWorking = true;
            
            // This is a simplified check - in reality, we'd need more sophisticated detection
            if (typeof window.console.warn.toString().includes('shouldSuppress')) {
                suppressionWorking = true;
            }
            
            document.getElementById('suppressionStatus').textContent = suppressionWorking ? 'Active ‚úÖ' : 'Inactive ‚ùå';
            addToMonitor(suppressionWorking ? '‚úÖ Suppression system is active' : '‚ùå Suppression system not detected', 
                        suppressionWorking ? 'success' : 'error');
        }

        function clearMonitor() {
            consoleMonitor.innerHTML = 'Console monitoring cleared...<br>';
        }

        function startMonitoring() {
            if (monitoringActive) return;
            
            monitoringActive = true;
            addToMonitor('‚ñ∂Ô∏è Console monitoring started', 'success');
            
            // Override console methods to monitor what's being logged
            console.log = function(...args) {
                addToMonitor(`LOG: ${args.join(' ')}`, 'info');
                originalConsole.log.apply(console, args);
            };
            
            console.warn = function(...args) {
                addToMonitor(`WARN: ${args.join(' ')}`, 'warning');
                originalConsole.warn.apply(console, args);
            };
            
            console.error = function(...args) {
                addToMonitor(`ERROR: ${args.join(' ')}`, 'error');
                originalConsole.error.apply(console, args);
            };
        }

        function openInIframe() {
            const container = document.getElementById('iframeContainer');
            const iframe = document.getElementById('testIframe');
            
            container.style.display = 'block';
            iframe.src = 'http://localhost:5175';
            
            addToMonitor('üñºÔ∏è Loading application in iframe...', 'info');
        }

        function testWithReload() {
            addToMonitor('üîÑ Testing with page reload...', 'info');
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        }

        function testMultipleTabs() {
            addToMonitor('üìë Opening multiple tabs...', 'info');
            
            const urls = [
                'http://localhost:5175',
                'http://localhost:5175/auth/login',
                'http://localhost:5175/studies',
                'http://localhost:5175/auth/register'
            ];
            
            urls.forEach((url, index) => {
                setTimeout(() => {
                    window.open(url, '_blank');
                    addToMonitor(`Tab ${index + 1} opened: ${url}`, 'success');
                }, index * 1000);
            });
        }

        // Initialize monitoring on page load
        document.addEventListener('DOMContentLoaded', function() {
            addToMonitor('üöÄ Real Application Console Test initialized', 'success');
            addToMonitor('üîç Ready to test console suppression in real application', 'info');
            
            // Auto-check suppression status
            setTimeout(checkSuppressionStatus, 1000);
        });
    </script>
</body>
</html>
