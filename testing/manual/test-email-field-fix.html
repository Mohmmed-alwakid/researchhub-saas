<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Field Fix Verification</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px 4px;
            font-size: 14px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .response {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Email Field Fix Verification</h1>
        <p><strong>Issue:</strong> User found duplicate email fields - one editable, one disabled</p>
        <p><strong>Fix:</strong> Removed editable email field from Personal Information section</p>
        <p><strong>Requirement:</strong> Email should be unchangeable (disabled only)</p>
    </div>

    <div class="container">
        <h2>üß™ Verification Tests</h2>
        
        <div class="test-section">
            <h3>1. Single Email Field Test</h3>
            <p><strong>Expected:</strong> Only ONE email field should exist on settings page</p>
            <button onclick="testSingleEmailField()" id="singleEmailBtn">Test Single Email Field</button>
            <div id="singleEmailResult" class="response"></div>
        </div>

        <div class="test-section">
            <h3>2. Email Field Disabled Test</h3>
            <p><strong>Expected:</strong> The email field should be disabled (unchangeable)</p>
            <button onclick="testEmailDisabled()" id="disabledBtn">Test Email Disabled</button>
            <div id="disabledResult" class="response"></div>
        </div>

        <div class="test-section">
            <h3>3. Demographics Section Test</h3>
            <p><strong>Expected:</strong> Email field should be in Demographics section only</p>
            <button onclick="testDemographicsSection()" id="demographicsBtn">Test Demographics Section</button>
            <div id="demographicsResult" class="response"></div>
        </div>

        <div class="test-section">
            <h3>4. Requirements Compliance Test</h3>
            <p><strong>Expected:</strong> All requirements should be met</p>
            <button onclick="testRequirementsCompliance()" id="complianceBtn">Test Requirements</button>
            <div id="complianceResult" class="response"></div>
        </div>
    </div>

    <div class="container">
        <h2>üìä Test Results Summary</h2>
        <div id="testSummary">
            <p>No tests run yet...</p>
        </div>
        
        <div style="margin-top: 30px;">
            <button onclick="runAllTests()" id="runAllBtn">üöÄ Run All Verification Tests</button>
            <button onclick="openSettingsPage()" id="openSettingsBtn">üåê Open Settings Page</button>
        </div>
    </div>

    <script>
        let testResults = {};

        function logResult(testName, success, message, details = null) {
            testResults[testName] = { success, message, details, timestamp: new Date() };
            
            const resultDiv = document.getElementById(testName + 'Result');
            if (resultDiv) {
                resultDiv.textContent = JSON.stringify({
                    success,
                    message,
                    details,
                    timestamp: new Date().toISOString()
                }, null, 2);
                
                resultDiv.parentElement.className = success ? 'test-section success' : 'test-section error';
            }
            
            updateTestSummary();
        }

        function updateTestSummary() {
            const summaryDiv = document.getElementById('testSummary');
            const results = Object.entries(testResults);
            const passed = results.filter(([k, v]) => v.success).length;
            const total = results.length;
            
            const summaryHTML = `
                <p><strong>Tests Completed:</strong> ${total}/4</p>
                <p><strong>Tests Passed:</strong> ${passed}/${total}</p>
                <p><strong>Success Rate:</strong> ${total > 0 ? Math.round((passed/total) * 100) : 0}%</p>
                <div style="margin-top: 15px;">
                    ${results.map(([test, result]) => `
                        <div style="margin: 8px 0; padding: 8px; border-radius: 4px; ${result.success ? 'background-color: #d4edda;' : 'background-color: #f8d7da;'}">
                            <strong>${test}:</strong> ${result.success ? '‚úÖ PASSED' : '‚ùå FAILED'} - ${result.message}
                        </div>
                    `).join('')}
                </div>
            `;
            
            summaryDiv.innerHTML = summaryHTML;
        }

        async function testSingleEmailField() {
            try {
                document.getElementById('singleEmailBtn').disabled = true;
                
                // Navigate to settings page and count email fields
                const response = await fetch('http://localhost:5175/settings');
                const html = await response.text();
                
                // Count occurrences of "Email Address" labels
                const emailLabelMatches = (html.match(/Email Address/g) || []).length;
                
                // Count email input fields
                const emailInputMatches = (html.match(/type="email"/g) || []).length;
                
                if (emailLabelMatches === 1 && emailInputMatches === 1) {
                    logResult('singleEmail', true, 'Only ONE email field found on settings page', {
                        emailLabels: emailLabelMatches,
                        emailInputs: emailInputMatches
                    });
                } else {
                    logResult('singleEmail', false, `Multiple email fields found: ${emailLabelMatches} labels, ${emailInputMatches} inputs`, {
                        emailLabels: emailLabelMatches,
                        emailInputs: emailInputMatches
                    });
                }
            } catch (error) {
                logResult('singleEmail', false, 'Error testing single email field: ' + error.message);
            } finally {
                document.getElementById('singleEmailBtn').disabled = false;
            }
        }

        async function testEmailDisabled() {
            try {
                document.getElementById('disabledBtn').disabled = true;
                
                const response = await fetch('http://localhost:5175/settings');
                const html = await response.text();
                
                // Check if email field has disabled attribute
                const hasDisabledEmail = html.includes('type="email"') && html.includes('disabled');
                
                // Check for disabled styling classes
                const hasDisabledStyling = html.includes('bg-gray-100') && html.includes('cursor-not-allowed');
                
                if (hasDisabledEmail && hasDisabledStyling) {
                    logResult('disabled', true, 'Email field is properly disabled with correct styling', {
                        hasDisabledAttribute: hasDisabledEmail,
                        hasDisabledStyling: hasDisabledStyling
                    });
                } else {
                    logResult('disabled', false, 'Email field is not properly disabled', {
                        hasDisabledAttribute: hasDisabledEmail,
                        hasDisabledStyling: hasDisabledStyling
                    });
                }
            } catch (error) {
                logResult('disabled', false, 'Error testing email disabled: ' + error.message);
            } finally {
                document.getElementById('disabledBtn').disabled = false;
            }
        }

        async function testDemographicsSection() {
            try {
                document.getElementById('demographicsBtn').disabled = true;
                
                const response = await fetch('http://localhost:5175/settings');
                const html = await response.text();
                
                // Check if email field is in demographics section (not personal info)
                const demographicsMatch = html.match(/Demographics[\s\S]*?Email Address[\s\S]*?disabled/);
                const personalInfoMatch = html.match(/Personal Information[\s\S]*?Email Address[\s\S]*?(?!disabled)/);
                
                if (demographicsMatch && !personalInfoMatch) {
                    logResult('demographics', true, 'Email field is correctly placed in Demographics section only', {
                        inDemographics: !!demographicsMatch,
                        inPersonalInfo: !!personalInfoMatch
                    });
                } else {
                    logResult('demographics', false, 'Email field placement issue detected', {
                        inDemographics: !!demographicsMatch,
                        inPersonalInfo: !!personalInfoMatch
                    });
                }
            } catch (error) {
                logResult('demographics', false, 'Error testing demographics section: ' + error.message);
            } finally {
                document.getElementById('demographicsBtn').disabled = false;
            }
        }

        async function testRequirementsCompliance() {
            try {
                document.getElementById('complianceBtn').disabled = true;
                
                const response = await fetch('http://localhost:5175/settings');
                const html = await response.text();
                
                // Check all requirements
                const emailUnchangeable = html.includes('disabled') && html.includes('type="email"');
                const saudiOnly = html.includes('Saudi Arabia') && !html.includes('United States');
                const genderLimited = (html.match(/male|female|prefer/gi) || []).length >= 3;
                const specializationDropdown = html.includes('specialization') || html.includes('Specialization');
                
                const allRequirementsMet = emailUnchangeable && saudiOnly && genderLimited && specializationDropdown;
                
                if (allRequirementsMet) {
                    logResult('compliance', true, 'All requirements are properly implemented', {
                        emailUnchangeable,
                        saudiOnly,
                        genderLimited,
                        specializationDropdown
                    });
                } else {
                    logResult('compliance', false, 'Some requirements are not met', {
                        emailUnchangeable,
                        saudiOnly,
                        genderLimited,
                        specializationDropdown
                    });
                }
            } catch (error) {
                logResult('compliance', false, 'Error testing requirements compliance: ' + error.message);
            } finally {
                document.getElementById('complianceBtn').disabled = false;
            }
        }

        async function runAllTests() {
            document.getElementById('runAllBtn').disabled = true;
            document.getElementById('runAllBtn').textContent = 'Running Tests...';
            
            try {
                await testSingleEmailField();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await testEmailDisabled();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await testDemographicsSection();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await testRequirementsCompliance();
                
            } catch (error) {
                console.error('Test suite error:', error);
            } finally {
                document.getElementById('runAllBtn').disabled = false;
                document.getElementById('runAllBtn').textContent = 'üöÄ Run All Verification Tests';
            }
        }

        function openSettingsPage() {
            window.open('http://localhost:5175/settings', '_blank');
        }

        // Initialize
        updateTestSummary();
    </script>
</body>
</html>
