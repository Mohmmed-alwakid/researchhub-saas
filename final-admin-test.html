<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Admin Account Test - ResearchHub</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #fafafa; }
        .success { background: #e8f5e8; border-color: #4caf50; }
        .critical { background: #ffe8e8; border-color: #f44336; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        button.success { background: #28a745; }
        button.admin { background: #dc3545; }
        .result { margin: 10px 0; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; white-space: pre-wrap; }
        .result.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .result.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .result.info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .highlight { background: yellow; padding: 2px 4px; border-radius: 3px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Final Admin Account Test - ResearchHub</h1>
        
        <div class="test-section critical">
            <h2>üö® UPDATED MANDATORY TEST ACCOUNTS</h2>
            <p><strong>‚úÖ ALL 3 ACCOUNTS NOW HAVE PASSWORDS:</strong></p>
            <ol>
                <li><span class="highlight">abwanwr77+participant@gmail.com</span> / Testtest123 (participant)</li>
                <li><span class="highlight">abwanwr77+Researcher@gmail.com</span> / Testtest123 (researcher)</li>
                <li><span class="highlight">abwanwr77+admin@gmail.com</span> / Testtest123 (admin) üÜï</li>
            </ol>
            <p><strong>‚ùå NO NEW ACCOUNTS ALLOWED ‚ùå</strong></p>
        </div>

        <div class="test-section success">
            <h3>‚úÖ Admin Account Created Successfully</h3>
            <p>The admin account <strong>abwanwr77+admin@gmail.com</strong> has been created with password <strong>Testtest123</strong></p>
        </div>

        <!-- Test All Three Accounts -->
        <div class="test-section">
            <h3>üîê Test All 3 Mandatory Accounts</h3>
            
            <h4>1. Test Participant Account</h4>
            <button onclick="testAccount('participant')" class="success">Test Participant Login</button>
            <div id="participantResult" class="result"></div>

            <h4>2. Test Researcher Account</h4>
            <button onclick="testAccount('researcher')" class="success">Test Researcher Login</button>
            <div id="researcherResult" class="result"></div>

            <h4>3. Test Admin Account</h4>
            <button onclick="testAccount('admin')" class="admin">Test Admin Login</button>
            <div id="adminResult" class="result"></div>
        </div>        <!-- Password Reset Test -->
        <div class="test-section">
            <h3>üîë Password Reset Test (Participant & Researcher Only)</h3>
            <button onclick="testPasswordReset('participant')">Test Participant Password Reset</button>
            <button onclick="testPasswordReset('researcher')">Test Researcher Password Reset</button>
            <div id="passwordResult" class="result"></div>
        </div>

        <!-- Role Fix -->
        <div class="test-section">
            <h3>üîß Fix Account Roles</h3>
            <p><strong>IMPORTANT:</strong> Use this if accounts are showing wrong roles!</p>
            <button onclick="fixAccountRoles()" class="admin">Fix All Account Roles</button>
            <div id="roleResult" class="result"></div>
        </div>

        <!-- Summary -->
        <div class="test-section">
            <h3>üìä Test Summary</h3>
            <div id="summary" class="result info">Click the test buttons above to verify all accounts</div>
        </div>
    </div>

    <script>
        const BASE_URL = 'https://researchhub-saas.vercel.app/api';
        
        const TEST_ACCOUNTS = {
            participant: {
                email: 'abwanwr77+participant@gmail.com',
                password: 'Testtest123',
                role: 'participant'
            },
            researcher: {
                email: 'abwanwr77+Researcher@gmail.com',
                password: 'Testtest123',
                role: 'researcher'
            },
            admin: {
                email: 'abwanwr77+admin@gmail.com',
                password: 'Testtest123',
                role: 'admin'
            }
        };

        let testResults = {
            participant: null,
            researcher: null,
            admin: null
        };

        async function testAccount(accountType) {
            const account = TEST_ACCOUNTS[accountType];
            const resultElementId = accountType + 'Result';

            try {
                showResult(resultElementId, `Testing ${accountType} account login...`, 'info');

                const response = await fetch(`${BASE_URL}/auth?action=login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: account.email,
                        password: account.password
                    }),
                });

                const result = await response.json();
                
                if (result.success) {
                    testResults[accountType] = true;
                    showResult(resultElementId, 
                        `‚úÖ SUCCESS: ${accountType} login working!\n` +
                        `Email: ${result.user.email}\n` +
                        `Role: ${result.user.role}\n` +
                        `Name: ${result.user.firstName} ${result.user.lastName}\n` +
                        `Token received: ${result.session ? 'Yes' : 'No'}`, 
                        'success'
                    );
                } else {
                    testResults[accountType] = false;
                    showResult(resultElementId, 
                        `‚ùå FAILED: ${accountType} login failed\n` +
                        `Error: ${result.error || result.message}`, 
                        'error'
                    );
                }

                updateSummary();

            } catch (error) {
                testResults[accountType] = false;
                showResult(resultElementId, `‚ùå ERROR: ${error.message}`, 'error');
                updateSummary();
            }
        }

        async function testPasswordReset(accountType) {
            const account = TEST_ACCOUNTS[accountType];

            try {
                showResult('passwordResult', `Testing password reset for ${accountType}...`, 'info');

                const response = await fetch(`${BASE_URL}/password?action=forgot`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: account.email
                    }),
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult('passwordResult', 
                        `‚úÖ Password reset request successful for ${accountType}\n` +
                        `Email: ${result.email}\n` +
                        `Message: ${result.message}`, 
                        'success'
                    );
                } else {
                    showResult('passwordResult', 
                        `‚ùå Password reset failed for ${accountType}\n` +
                        `Error: ${result.error || result.message}`, 
                        'error'
                    );
                }

            } catch (error) {
                showResult('passwordResult', `‚ùå ERROR: ${error.message}`, 'error');
            }        }

        async function fixAccountRoles() {
            try {
                showResult('roleResult', 'Fixing account roles...', 'info');

                const response = await fetch(`${BASE_URL}/admin-setup`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'fix_roles'
                    }),
                });

                const result = await response.json();
                
                if (result.success) {
                    let resultText = '‚úÖ Role fix completed!\n\n';
                    result.results.forEach(r => {
                        resultText += `${r.account}: ${r.status} (${r.email})\n`;
                        if (r.role) resultText += `  ‚Üí Role set to: ${r.role}\n`;
                        if (r.error) resultText += `  ‚Üí Error: ${r.error}\n`;
                    });
                    
                    showResult('roleResult', resultText, 'success');
                } else {
                    showResult('roleResult', 
                        `‚ùå Role fix failed\n` +
                        `Error: ${result.error || result.message}`, 
                        'error'
                    );
                }

            } catch (error) {
                showResult('roleResult', `‚ùå ERROR: ${error.message}`, 'error');
            }
        }

        function updateSummary() {
            const participantStatus = testResults.participant === true ? '‚úÖ' : testResults.participant === false ? '‚ùå' : '‚è≥';
            const researcherStatus = testResults.researcher === true ? '‚úÖ' : testResults.researcher === false ? '‚ùå' : '‚è≥';
            const adminStatus = testResults.admin === true ? '‚úÖ' : testResults.admin === false ? '‚ùå' : '‚è≥';

            const summary = 
                `ACCOUNT LOGIN TEST RESULTS:\n` +
                `${participantStatus} Participant (abwanwr77+participant@gmail.com)\n` +
                `${researcherStatus} Researcher (abwanwr77+Researcher@gmail.com)\n` +
                `${adminStatus} Admin (abwanwr77+admin@gmail.com)\n\n` +
                `STATUS: All accounts ${testResults.participant && testResults.researcher && testResults.admin ? 'WORKING ‚úÖ' : 'need testing ‚è≥'}`;

            showResult('summary', summary, 'info');
        }

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }

        // Initialize
        updateSummary();
    </script>
</body>
</html>
